

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: model/UnitExpression.js | Source: model/UnitExpression.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-jsdoc.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/tui-doc.css">

    
</head>
<body>
<nav class="lnb" id="lnb">
    <div class="logo" style="">
        
            <img src="img/toast-ui.png" width="100%" height="100%">
        
    </div>
    <div class="title">
        <h1><a href="index.html" class="link">Source: model/UnitExpression.js</a></h1>
        
    </div>
    <div class="search-container" id="search-container">
        <input type="text" placeholder="Search">
        <ul></ul>
    </div>
    
    <div class="lnb-api hidden"><h3>Modules</h3><ul><li><a href="module-steradian.html">steradian</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:steradian_sub"><div class="member-type">Typedef</div><ul class="inner"><li><a href="module-steradian.html#~BaseUnitDefinition">BaseUnitDefinition</a></li><li><a href="module-steradian.html#~DerivedUnitDefinition">DerivedUnitDefinition</a></li><li><a href="module-steradian.html#~SystemDefinition">SystemDefinition</a></li></ul></div></li></ul></div><div class="lnb-api hidden"><h3>Classes</h3><ul><li><a href="BaseUnit.html">BaseUnit</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="BaseUnit_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="BaseUnit.html#dimensions">dimensions</a></li><li><a href="BaseUnit.html#expression">expression</a></li><li><a href="BaseUnit.html#isBaseUnit">isBaseUnit</a></li><li><a href="BaseUnit.html#name">name</a></li><li><a href="BaseUnit.html#scale">scale</a></li><li><a href="BaseUnit.html#symbol">symbol</a></li><li><a href="BaseUnit.html#toString">toString</a></li><li><a href="BaseUnit.html#type">type</a></li></ul></div></li><li><a href="DerivedUnit.html">DerivedUnit</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="DerivedUnit_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="DerivedUnit.html#dimensions">dimensions</a></li><li><a href="DerivedUnit.html#expression">expression</a></li><li><a href="DerivedUnit.html#isBaseUnit">isBaseUnit</a></li><li><a href="DerivedUnit.html#name">name</a></li><li><a href="DerivedUnit.html#scale">scale</a></li><li><a href="DerivedUnit.html#symbol">symbol</a></li><li><a href="DerivedUnit.html#toString">toString</a></li></ul></div></li><li><a href="Dimensions.html">Dimensions</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Dimensions_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="Dimensions.html#.empty">empty</a></li><li><a href="Dimensions.html#add">add</a></li><li><a href="Dimensions.html#equals">equals</a></li><li><a href="Dimensions.html#get">get</a></li><li><a href="Dimensions.html#mult">mult</a></li><li><a href="Dimensions.html#size">size</a></li></ul></div></li><li><a href="Quantity.html">Quantity</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Quantity_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="Quantity.html#convertTo">convertTo</a></li><li><a href="Quantity.html#dividedBy">dividedBy</a></li><li><a href="Quantity.html#minus">minus</a></li><li><a href="Quantity.html#plus">plus</a></li><li><a href="Quantity.html#times">times</a></li><li><a href="Quantity.html#toString">toString</a></li><li><a href="Quantity.html#units">units</a></li><li><a href="Quantity.html#value">value</a></li></ul></div></li><li><a href="Steradian.html">Steradian</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Steradian_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="Steradian.html#convert">convert</a></li><li><a href="Steradian.html#derivedUnit">derivedUnit</a></li><li><a href="Steradian.html#quantity">quantity</a></li><li><a href="Steradian.html#system">system</a></li><li><a href="Steradian.html#unit">unit</a></li></ul></div></li><li><a href="System.html">System</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="System_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="System.html#other">other</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="System.html#allUnits">allUnits</a></li><li><a href="System.html#name">name</a></li><li><a href="System.html#toString">toString</a></li></ul></div></li><li><a href="Term.html">Term</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Term_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="Term.html#power">power</a></li><li><a href="Term.html#toString">toString</a></li><li><a href="Term.html#unit">unit</a></li></ul></div></li><li><a href="Unit.html">Unit</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Unit_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="Unit.html#.isUnit">isUnit</a></li><li><a href="Unit.html#dimensions">dimensions</a></li><li><a href="Unit.html#expression">expression</a></li><li><a href="Unit.html#isBaseUnit">isBaseUnit</a></li><li><a href="Unit.html#name">name</a></li><li><a href="Unit.html#scale">scale</a></li><li><a href="Unit.html#symbol">symbol</a></li><li><a href="Unit.html#toString">toString</a></li></ul></div></li><li><a href="UnitExpression.html">UnitExpression</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="UnitExpression_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="UnitExpression.html#dimensions">dimensions</a></li><li><a href="UnitExpression.html#div">div</a></li><li><a href="UnitExpression.html#mult">mult</a></li><li><a href="UnitExpression.html#pow">pow</a></li><li><a href="UnitExpression.html#simplify">simplify</a></li><li><a href="UnitExpression.html#terms">terms</a></li><li><a href="UnitExpression.html#toBaseUnits">toBaseUnits</a></li><li><a href="UnitExpression.html#toMap">toMap</a></li><li><a href="UnitExpression.html#toString">toString</a></li></ul></div></li></ul></div><div class="lnb-api hidden"><h3>Namespaces</h3><ul><li><a href="DerivedUnitType.html">DerivedUnitType</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="DerivedUnitType_sub"></div></li><li><a href="UnitType.html">UnitType</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="UnitType_sub"></div></li></ul></div>
</nav>
<div id="resizer"></div>

<div class="main" id="main">
    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>define(['Guard', 'Arrays', 'Term', 'Dimensions'], function(Guard, Arrays, Term, Dimensions) {
	/**
	 * @classdesc
	 * Represents an expression made of composed Units.
	 * This structure is the basis of DerivedUnit definitions.
	 * 
	 * Logically, a UnitExpression represents a list of Terms multiplied
	 * together.  Each Term has a base "unit" and a power.
	 * 
	 * For instance, a UnitExpression that represents "meter per second squared,"
	 * would consist of one Term that represents "meter" (to the first power) and another
	 * Term that represents "second squared."
	 * @class
	 * @alias UnitExpression
	 * @hideconstructor
	 * @param {array&lt;Term>}} terms 
	 */
	function UnitExpression(terms) {
		Guard(terms, "terms").isArrayOf(Term);
		this._terms = Arrays.frozenClone(terms);
		var that = this;
		var dimensions = null;
		this._dimensions = function() {
			if (dimensions === null) {
				dimensions = getDimensions.call(that);
			}
			return dimensions;
		};
		Object.freeze(this);
	}

	function getDimensions() {
		var dim = this._terms
			.map(function(t) {
				return t.unit()
					.dimensions()
					.mult(t.power());
			})
			.reduce(function(acc, item) {
				return acc.add(item);
			}, Dimensions.empty());
		return dim;
	}

	UnitExpression.prototype = 
	/** @lends UnitExpression# */
	{
		/**
		 * Returns an immutable array of Terms that make up the UnitExpression.
		 * @method
		 * @type {array&lt;Term>}
		 */
		terms: function() {
			return this._terms;
		},
		/**
		 * Returns a Dimensions object that represents the unit dimensions of
		 * this UnitExpression.
		 * @method
		 * @type {Dimensions}
		 */
		dimensions: function() {
			return this._dimensions();
		},
		/**
		 * Multiplies this UnitExpression by another UnitExpression
		 * and returns the result as another UnitExpression.
		 * 
		 * Logically, this operation is implemented by concatenating
		 * all of the terms together and combining like bases.
		 * @method
		 * @param {UnitExpression} rhs
		 * @type {UnitExpression}
		 */
		mult: function(rhs) {
			var terms = flatten([this.terms(), rhs.terms()]);
			terms = combineLikeTerms(terms);
			return new UnitExpression(terms);
		},
		/**
		 * Divides this UnitExpression by another UnitExpression
		 * and returns the result as another UnitExpression.
		 * 
		 * Logically, this operation is implemented by inverting the
		 * divisor `rhs` and performing a multiplication operation.
		 * @method
		 * @param {UnitExpression} rhs 
		 * @type {UnitExpression}
		 */
		div: function(rhs) {
			var inverseRhs = new UnitExpression(rhs.terms().map(invert));
			return this.mult(inverseRhs);
		},
		/**
		 * Exponentiates this UnitExpression by the given
		 * power and returns the result as another UnitExpression.
		 * @method
		 * @param {number} power
		 * @type {UnitExpression}
		 */
		pow: function(power) {
			var exponentiatedTerms = this.terms().map(termExponent(power));
			return new UnitExpression(exponentiatedTerms);
		},
		/**
		 * Recursively breaks down this UnitExpression into its constituent
		 * Terms and each Term into its constituent BaseUnits,
		 * until only BaseUnits are left.
		 * @method
		 * @type {UnitExpression}
		 */
		toBaseUnits: function() {
			var baseTerms = getEquivalentBaseTermsForList(this.terms());
			return new UnitExpression(baseTerms);
		},
		/**
		 * Simplifies the UnitExpression by combining like Terms.
		 * @method
		 * @type {UnitExpression}
		 */
		simplify: function() {
			return new UnitExpression(combineLikeTerms(this.terms()));
		},
		/**
		 * Projects this UnitExpression onto an equivalent map,
		 * where each unit type becomes a key, and the value
		 * is the sum of all the powers of the Terms of that type.
		 * @method
		 * @type {object}
		 */
		toMap: function() {
			var terms = combineLikeTerms(this.terms());

			return terms.reduce(
				function(map, term) {
					map[term.unit().name()] = term.power();
					return map;
				}, 
				Object.create(null)
			);
		},
		/**
		 * Returns a string representation of the given UnitExpression.
		 * 
		 * For example, the string representation of a UnitExpression 
		 * that represents "meters per second squared" will be "m/s^2".
		 * @method
		 * @type {string}
		 */
		toString: function() {
			var terms = this._terms;
			 var reduced = terms
			 	.map(function(term) {
					var unitString = term.unit().toString();
					var opString = getOperatorString(term);
					var powerString = getPowerString(term);
					if (term.power() === 0) {
						return "";
					}
					return opString + unitString + powerString;
				})
				.reduce(function(acc, termString) {
					if (acc === "") {
						if (termString.startsWith(" ")) {
							termString = termString.substring(1);
						}
					}
					return acc + termString;
				}, "");

			return reduced;
		}
	};

	Object.defineProperty(UnitExpression.prototype, 'constructor', {
		value: UnitExpression,
		enumerable: false,
		writable: true
	});
	
	function termExponent(power) {
		return function(t) {
			return new Term(t.unit(), t.power() * power); 	
		};
	}
	
	function unitProperty(term) {
		return term.unit();
	}
	
	function combineLikeTerms(terms) {
		Guard(terms, "terms").isArrayOf(Term);
		var groupedTerms = groupBy(terms, unitProperty);
		var outputTerms = Object.keys(groupedTerms)
			.map(function(groupName) {
				var group = groupedTerms[groupName];
				return new Term(group.key, sumPowersOf(group.items));
			});
		return outputTerms;
	}
	
	function invert(term) {
		return new Term(term.unit(), -term.power());
	}
	
	function flatten(arrays) {
		var flattened = [];
		arrays.forEach(function(a) { 
			Array.prototype.push.apply(flattened, a);
		});
		return flattened;
	}
	
	function groupBy(arr, keySelector) {
		var groups = Object.create(null);
		for (var i = 0; i &lt; arr.length; i++) {
			var item = arr[i];
			var key = keySelector(item);
			var group = groups[key] || { key: key, items: [] };
			group.items.push(item);
			groups[key] = group;
		}
		return groups;
	}
	
	function sumPowersOf(terms) {
		var sum = terms.reduce(function(acc, t) { return acc + t.power(); }, 0);
		return sum;
	}
	
	function emptyUnitExpression() {
		return new UnitExpression([]);
	}

	/**
	 * Given an array of Terms (which could be in any type of units), returns an
	 * array of equivalent BaseUnit terms.
	 * @param {Term[]} terms 
	 */
	function getEquivalentBaseTermsForList(terms) {
		return terms.map(function(term) {
			return new UnitExpression(getEquivalentBaseTerms(term));
		}).reduce(function(acc, expr) {
			return acc.mult(expr);
		}, emptyUnitExpression()
		).terms();
	}

	/**
	 * Given a Term (which could be in any Units) returns an equivalent array of 
	 * Terms expressed in BaseUnits.
	 * @param {Term} term 
	 */
	function getEquivalentBaseTerms(term) {
		Guard(term, "term").instanceOf(Term);
		var unit = term.unit();
		if (unit.isBaseUnit()) {
			return [ term ];
		}
		else {
			var subTermsExpr = unit.expression().pow(term.power());
			return getEquivalentBaseTermsForList(subTermsExpr.terms());			
		}
	}

	function getOperatorString(term) {
		var power = term.power();
		if (power === 0) {
			return "";
		}
		else if (power &lt; 0) {
			return "/";
		}
		else if (power > 0) {
			return " ";
		}
		else {
			throw new Error("'power' had the unexpected value '" + power + "'.");
		}
	}

	function getPowerString(term) {
		var power = term.power();
		var absPower = Math.abs(power);
		if (absPower === 0 || absPower === 1) {
			return "";
		}
		return "^" + absPower;
	}
	
	return UnitExpression;
});</code></pre>
        </article>
    </section>




</div>

<footer>
    <img class="logo" src="img/toast-ui.png" style="">
    <div class="footer-text">NHN Entertainment. Frontend Development Lab</div>
</footer>
<script>prettyPrint();</script>
<script src="scripts/jquery.min.js"></script>
<script src="scripts/tui-doc.js"></script>
<script src="scripts/linenumber.js"></script>

    <script>
        var id = '_sub'.replace(/"/g, '_');
        var selectedApi = document.getElementById(id); // do not use jquery selector
        var $selectedApi = $(selectedApi);

        $selectedApi.removeClass('hidden');
        $selectedApi.parent().find('.glyphicon').removeClass('glyphicon-plus').addClass('glyphicon-minus');
        showLnbApi();
    </script>

</body>
</html>
